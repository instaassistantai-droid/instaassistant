<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard â€“ InstaAssistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body {
  margin:0;
  font-family: Inter, system-ui, Arial;
  background:#020617;
  color:white;
}

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 24px;
  border-bottom:1px solid #1e293b;
}

.logo { font-weight:700; font-size:18px; }

.logout {
  background:#38bdf8;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}

.container {
  max-width:1100px;
  margin:auto;
  padding:28px 18px;
}

.card {
  background:#020617;
  border:1px solid #1e293b;
  border-radius:18px;
  padding:22px;
  margin-bottom:22px;
}

.profile {
  display:flex;
  gap:20px;
  align-items:center;
  flex-wrap:wrap;
}

.profile img {
  width:110px;
  height:110px;
  border-radius:50%;
  border:3px solid #38bdf8;
  object-fit:cover;
}

input, textarea {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #1e293b;
  background:#020617;
  color:white;
}

button {
  padding:12px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  background:#0f172a;
  color:white;
  font-weight:600;
}

.primary { background:#38bdf8; color:#020617; }

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
  margin-top:14px;
}

.platform {
  border:1px solid #1e293b;
  border-radius:14px;
  padding:16px;
  text-align:center;
}

.platform button { width:100%; margin-top:10px; }

.linkbox {
  background:#0f172a;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
  word-break:break-all;
}
</style>
</head>

<body>

<header>
  <div class="logo">ğŸš€ InstaAssistant</div>
  <button class="logout" onclick="logout()">Logout</button>
</header>

<div class="container">

  <!-- PROFILE -->
  <div class="card profile">
    <div>
      <img id="avatar" src="https://i.pravatar.cc/300">
      <input type="file" id="photoInput" accept="image/*" onchange="updatePhoto()">
    </div>

    <div style="flex:1; min-width:240px">
      <h2 id="name">Loading...</h2>
      <div id="username" style="color:#94a3b8"></div>

      <textarea id="bio" rows="3" placeholder="Write your bio..."></textarea>
      <button class="primary" onclick="saveProfile()">Save profile</button>

      <div class="linkbox">
        Public page: <br>
        <a id="publicLink" href="#" target="_blank" style="color:#38bdf8"></a>
      </div>
    </div>
  </div>

  <!-- CONNECT -->
  <div class="card">
    <h3>ğŸ”— Connect your platforms</h3>
    <div class="grid">

      <div class="platform">
        ğŸ“¸ Instagram
        <button onclick="connectPlatform('Instagram')">Connect Instagram</button>
      </div>

      <div class="platform">
        â–¶ï¸ YouTube
        <button onclick="connectPlatform('YouTube')">Connect YouTube</button>
      </div>

      <div class="platform">
        ğŸµ TikTok
        <button onclick="connectPlatform('TikTok')">Connect TikTok</button>
      </div>

      <div class="platform">
        ğŸ§ Spotify
        <button onclick="connectPlatform('Spotify')">Connect Spotify</button>
      </div>

    </div>
  </div>

  <!-- TRENDS -->
  <div class="card">
    <h3>ğŸ“ˆ Trends & insights (demo)</h3>
    <p style="color:#94a3b8">ğŸ”¥ Reels engagement +32%<br>ğŸ‘€ Profile visits 1,248<br>ğŸ’¬ DMs 87<br>ğŸš€ Best time: 7:30 PM</p>
  </div>

</div>

<script>
const SUPABASE_URL = "https://ymbhbwnsoxbfusltoazm.supabase.co";
const SUPABASE_KEY = "sb_publishable_wdK0N_KT3ZabHESPxjQ70A_R5Vup_84";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let currentUser = null;
let creatorData = null;

async function loadDashboard(){
  const { data: { user } } = await supabase.auth.getUser();
  if(!user){ window.location.href="/login.html"; return; }
  currentUser = user;

  const { data } = await supabase.from("creators").select("*").eq("id", user.id).single();
  creatorData = data;

  document.getElementById("name").innerText = data.name;
  document.getElementById("username").innerText = "@"+data.username;
  document.getElementById("bio").value = data.bio || "";
  document.getElementById("avatar").src = data.profile_image || "https://i.pravatar.cc/300";

  const link = "https://instaassistant.vercel.app/creator.html?u="+data.username;
  document.getElementById("publicLink").innerText = link;
  document.getElementById("publicLink").href = link;
}

async function saveProfile(){
  const bio = document.getElementById("bio").value;

  await supabase.from("creators").update({ bio }).eq("id", currentUser.id);
  alert("Profile updated âœ…");
}

async function updatePhoto(){
  const file = document.getElementById("photoInput").files[0];
  if(!file) return;

  const fileName = currentUser.id+"-"+Date.now();

  const { data } = await supabase.storage.from("avatars").upload(fileName, file, { upsert:true });

  const { data: url } = supabase.storage.from("avatars").getPublicUrl(fileName);

  await supabase.from("creators").update({
    profile_image: url.publicUrl
  }).eq("id", currentUser.id);

  document.getElementById("avatar").src = url.publicUrl;
  alert("Photo updated ğŸ”¥");
}

function connectPlatform(name){
  alert(name+" OAuth connect yahan aayega.\nNext step me real Instagram/YouTube connect karenge.");
}

async function logout(){
  await supabase.auth.signOut();
  window.location.href="/login.html";
}

loadDashboard();
</script>
</body>
</html>
