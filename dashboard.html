<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard â€“ InstaAssistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@supabase/supabase-js@1.35.7/dist/umd/supabase.js"></script>

<style>
body{
margin:0;
font-family:Inter,system-ui;
background:#020617;
color:white;
}
header{
padding:16px 20px;
border-bottom:1px solid #0f172a;
display:flex;
justify-content:space-between;
align-items:center;
}
.container{max-width:900px;margin:auto;padding:20px}
.card{
background:#020617;
border:1px solid #0f172a;
border-radius:18px;
padding:20px;
margin-bottom:18px;
}
.profile{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
.avatar{width:90px;height:90px;border-radius:50%;border:3px solid #38bdf8;object-fit:cover}
input,textarea{
width:100%;
padding:12px;
border-radius:10px;
border:1px solid #0f172a;
background:#020617;
color:white;
margin-top:10px;
}
button{
background:#38bdf8;
border:none;
padding:12px 16px;
border-radius:10px;
font-weight:600;
cursor:pointer;
margin-top:10px;
}
button:hover{background:#0ea5e9}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.platform{
border:1px solid #0f172a;
border-radius:14px;
padding:14px;
text-align:center;
}
.logout{background:#ef4444;color:white}
small{color:#94a3b8}
</style>
</head>

<body>

<header>
<div>ðŸš€ InstaAssistant</div>
<button class="logout" onclick="logout()">Logout</button>
</header>

<div class="container">

<div class="card profile">
<img id="avatar" class="avatar" src="https://i.pravatar.cc/200">
<div style="flex:1">
<h2 id="name">Loading...</h2>
<p id="username" style="color:#94a3b8"></p>
<input type="file" accept="image/*" onchange="updatePhoto(event)">
<input id="bio" placeholder="Your bio">
<button onclick="saveProfile()">Save profile</button>
<p><small>Public page: </small><span id="publicUrl"></span></p>
</div>
</div>

<div class="card">
<h3>ðŸ”— Connect platforms</h3>
<div class="grid">
<div class="platform"><b>Instagram</b><br><button onclick="connect('Instagram')">Connect</button></div>
<div class="platform"><b>YouTube</b><br><button onclick="connect('YouTube')">Connect</button></div>
<div class="platform"><b>TikTok</b><br><button onclick="connect('TikTok')">Connect</button></div>
<div class="platform"><b>Spotify</b><br><button onclick="connect('Spotify')">Connect</button></div>
</div>
</div>

<div class="card">
<h3>ðŸ“ˆ Trends & insights (demo)</h3>
<ul style="color:#94a3b8">
<li>Reels engagement â†‘ 32%</li>
<li>DM response rate â†‘ 18%</li>
<li>Profile visits â†‘ 21%</li>
</ul>
</div>

</div>

<script>
const SUPABASE_URL = "https://ymbhbwnsoxbfusltoazm.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltYmhid25zb3hiZnVzbHRvYXptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1Nzc1MzMsImV4cCI6MjA4NTE1MzUzM30.zN743oVTAKPrfX4PAs1oBjUiszy6nAae6a_NTYhGPCE";

const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let currentUser = null;

init();

async function init(){
const user = client.auth.user();
if(!user){ location.href="/login.html"; return; }
currentUser = user;

const {data} = await client.from("creators").select("*").eq("id",user.id).single();

document.getElementById("name").innerText = data.name;
document.getElementById("username").innerText = "@"+data.username;
document.getElementById("bio").value = data.bio || "";
document.getElementById("avatar").src = data.profile_image;
document.getElementById("publicUrl").innerText = location.origin+"/creator.html?u="+data.username;
}

async function updatePhoto(e){
const file = e.target.files[0];
const fileName = currentUser.id+"-"+Date.now();

await client.storage.from("avatars").upload(fileName,file,{upsert:true});
const { publicURL } = client.storage.from("avatars").getPublicUrl(fileName);

document.getElementById("avatar").src = publicURL;
await client.from("creators").update({profile_image:publicURL}).eq("id",currentUser.id);
}

async function saveProfile(){
const bio = document.getElementById("bio").value;
await client.from("creators").update({bio}).eq("id",currentUser.id);
alert("Profile updated");
}

function connect(name){
alert(name+" connect flow coming next ðŸš€");
}

async function logout(){
await client.auth.signOut();
location.href="/login.html";
}
</script>

</body>
</html>
