<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://ymbhbwnsoxbfusltoazm.supabase.co";
const SUPABASE_KEY = "sb_publishable_wdK0N_KT3ZabHESPxjQ70A_R5Vup_84";

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_KEY);

const params = new URLSearchParams(window.location.search);
const username = params.get("u");

async function loadCreator() {

  if (!username) {
    document.body.innerHTML = "<h2 style='color:white'>No username provided</h2>";
    return;
  }

  const { data: creator, error } = await db
    .from("creators")
    .select("*")
    .eq("username", username)
    .single();

  if (error || !creator) {
    document.body.innerHTML = "<h2 style='color:white'>Creator not found</h2>";
    return;
  }

  document.title = creator.name;
  document.getElementById("avatar").src = creator.profile_image;
  document.getElementById("name").innerText = creator.name;
  document.getElementById("bio").innerText = creator.bio;

  const { data: links } = await db
    .from("links")
    .select("*")
    .eq("creator_id", creator.id)
    .eq("is_active", true)
    .order("order_no");

  const box = document.getElementById("links");
  box.innerHTML = "";

  links.forEach(link => {
    const a = document.createElement("a");
    a.href = link.url;
    a.target = "_blank";
    a.innerText = link.title || "Visit";
    box.appendChild(a);
  });
}

loadCreator();
</script>
